{% comment %}
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EMERSON BY AVERY â€” INSTAGRAM FEED 
  Display Instagram posts by username using Instafeed.js
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{% endcomment %}

{{ 'section-emerson-instagram.css' | asset_url | stylesheet_tag }}

<section 
  class="emerson-instagram"
  data-section-id="{{ section.id }}"
  data-instagram-handle="{{ section.settings.instagram_handle }}"
  data-posts-count="{{ section.settings.posts_count | default: 6 }}"
  style="--section-bg: {{ section.settings.bg_color }};"
>
  <div class="emerson-instagram__container">
    <!-- Header -->
    <div class="emerson-instagram__header" data-animate="fade-up">
      {%- if section.settings.eyebrow != blank -%}
        <span class="emerson-section-eyebrow">{{ section.settings.eyebrow }}</span>
      {%- endif -%}
      {%- if section.settings.heading != blank -%}
        <h2 class="emerson-section-title">{{ section.settings.heading }}</h2>
      {%- endif -%}
      {%- if section.settings.instagram_handle != blank -%}
        <a href="https://instagram.com/{{ section.settings.instagram_handle | remove: '@' }}" target="_blank" rel="noopener" class="emerson-instagram__handle">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="2" width="20" height="20" rx="5"/>
            <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/>
            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
          </svg>
          {{ section.settings.instagram_handle }}
        </a>
      {%- endif -%}
    </div>

    <!-- Instagram Grid -->
    <div id="instafeed-{{ section.id }}" class="emerson-instagram__grid"></div>

    {%- if section.settings.button_text != blank -%}
      <div class="emerson-instagram__cta" data-animate="fade-up">
        <a 
          href="https://instagram.com/{{ section.settings.instagram_handle | remove: '@' }}" 
          target="_blank" 
          rel="noopener" 
          class="emerson-btn emerson-btn--secondary"
        >
          {{ section.settings.button_text }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
            <polyline points="15 3 21 3 21 9"/>
            <line x1="10" y1="14" x2="21" y2="3"/>
          </svg>
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<!-- Instafeed.js library -->
<script src="https://cdn.jsdelivr.net/gh/stevenschobert/instafeed.js@2.0.0rc1/src/instafeed.min.js"></script>

<script>
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    // Animation Observer
    const observerOptions = { threshold: 0.15, rootMargin: '0px 0px -80px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
        }
      });
    }, observerOptions);

    section.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));

    // Instagram Feed Integration
    const instagramHandle = section.dataset.instagramHandle;
    const postsCount = parseInt(section.dataset.postsCount) || 6;

    if (instagramHandle && instagramHandle.trim() !== '') {
      const feed = new Instafeed({
        get: 'user',
        target: 'instafeed-{{ section.id }}',
        limit: postsCount,
        resolution: 'standard_resolution',
        sortBy: 'most-recent',
        template: `
          <a 
            class="emerson-instagram__item" 
            href="{{link}}"
            target="_blank"
            rel="noopener"
            data-animate="zoom-in"
            data-delay="{{model.index}}"
          >
            <img 
              src="{{image}}" 
              alt="{{caption}}"
              loading="lazy"
              class="emerson-instagram__img"
            />
            <div class="emerson-instagram__item-overlay">
              <span class="emerson-instagram__item-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="2" width="20" height="20" rx="5"/>
                  <path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/>
                  <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
                </svg>
              </span>
            </div>
          </a>
        `
      });

      try {
        feed.run();
      } catch (error) {
        console.error('Instafeed.js error:', error);
      }
    }
  })();
</script>

{% schema %}
{
  "name": "ğŸ“¸ Instagram Feed",
  "tag": "section",
  "class": "section-emerson-instagram",
  "settings": [
    {
      "type": "header",
      "content": "Instagram Settings"
    },
    {
      "type": "text",
      "id": "instagram_handle",
      "label": "Instagram handle",
      "info": "Enter without @ symbol, e.g. emersonbyavery",
      "default": "emersonbyavery"
    },
    {
      "type": "range",
      "id": "posts_count",
      "label": "Number of posts",
      "min": 4,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow",
      "default": "Follow Along"
    },
    {
      "type": "text", 
      "id": "heading",
      "label": "Heading",
      "default": "Join Our Creative Journey"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Follow on Instagram"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "bg_color",  
      "label": "Background color",
      "default": "#FFFFFF"
    }
  ],
  "presets": [
    {
      "name": "ğŸ“¸ Instagram Feed"
    }
  ]
}
{% endschema %}
