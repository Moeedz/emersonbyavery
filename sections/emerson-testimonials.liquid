{% comment %}
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EMERSON BY AVERY â€” TESTIMONIALS
  Auto-scrolling infinite carousel with pause on hover
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{% endcomment %}

{{ 'section-emerson-testimonials.css' | asset_url | stylesheet_tag }}

<section 
  class="emerson-testimonials"
  data-section-id="{{ section.id }}"
  style="--section-bg: {{ section.settings.bg_color }};"
>
  <!-- Header -->
  <div class="emerson-testimonials__header" data-animate="fade-up">
    {%- if section.settings.eyebrow != blank -%}
      <span class="emerson-section-eyebrow">{{ section.settings.eyebrow }}</span>
    {%- endif -%}
    {%- if section.settings.heading != blank -%}
      <h2 class="emerson-section-title">{{ section.settings.heading }}</h2>
    {%- endif -%}
    
    {%- if section.settings.show_rating_badge -%}
      <div class="emerson-testimonials__rating-badge">
        <span class="emerson-testimonials__stars">â˜…â˜…â˜…â˜…â˜…</span>
        <span class="emerson-testimonials__rating-text">{{ section.settings.rating_text | default: '100% 5-Star Reviews' }}</span>
      </div>
    {%- endif -%}
  </div>

  <!-- Slider -->
  <div class="emerson-testimonials__slider">
    <div class="emerson-testimonials__track">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'testimonial' -%}
            <div class="emerson-testimonial-card" {{ block.shopify_attributes }}>
              <div class="emerson-testimonial__header">
                <div class="emerson-testimonial__avatar">
                  {%- if block.settings.avatar != blank -%}
                    {{ block.settings.avatar | image_url: width: 120 | image_tag }}
                  {%- else -%}
                    {{ block.settings.author | slice: 0, 2 | upcase }}
                  {%- endif -%}
                </div>
                <div class="emerson-testimonial__info">
                  <h4>{{ block.settings.author }}</h4>
                  <span>{{ block.settings.subtitle | default: 'Verified Buyer' }}</span>
                </div>
              </div>
              
              <div class="emerson-testimonial__rating">â˜…â˜…â˜…â˜…â˜…</div>
              
              <p class="emerson-testimonial__text">{{ block.settings.quote }}</p>
              
              {%- if block.settings.product_name != blank -%}
                <div class="emerson-testimonial__product">
                  <div class="emerson-testimonial__product-img">
                    {%- if block.settings.product_image != blank -%}
                      {{ block.settings.product_image | image_url: width: 100 | image_tag }}
                    {%- else -%}
                      {{ block.settings.product_emoji | default: 'ğŸŒˆ' }}
                    {%- endif -%}
                  </div>
                  <div class="emerson-testimonial__product-info">
                    <strong>{{ block.settings.product_name }}</strong>
                    {%- if block.settings.product_price != blank -%}
                      <span>{{ block.settings.product_price }}</span>
                    {%- endif -%}
                  </div>
                </div>
              {%- endif -%}
            </div>
        {%- endcase -%}
      {%- endfor -%}
      
      <!-- Duplicate for infinite scroll -->
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'testimonial' -%}
            <div class="emerson-testimonial-card" aria-hidden="true">
              <div class="emerson-testimonial__header">
                <div class="emerson-testimonial__avatar">
                  {%- if block.settings.avatar != blank -%}
                    {{ block.settings.avatar | image_url: width: 120 | image_tag }}
                  {%- else -%}
                    {{ block.settings.author | slice: 0, 2 | upcase }}
                  {%- endif -%}
                </div>
                <div class="emerson-testimonial__info">
                  <h4>{{ block.settings.author }}</h4>
                  <span>{{ block.settings.subtitle | default: 'Verified Buyer' }}</span>
                </div>
              </div>
              
              <div class="emerson-testimonial__rating">â˜…â˜…â˜…â˜…â˜…</div>
              
              <p class="emerson-testimonial__text">{{ block.settings.quote }}</p>
              
              {%- if block.settings.product_name != blank -%}
                <div class="emerson-testimonial__product">
                  <div class="emerson-testimonial__product-img">
                    {%- if block.settings.product_image != blank -%}
                      {{ block.settings.product_image | image_url: width: 100 | image_tag }}
                    {%- else -%}
                      {{ block.settings.product_emoji | default: 'ğŸŒˆ' }}
                    {%- endif -%}
                  </div>
                  <div class="emerson-testimonial__product-info">
                    <strong>{{ block.settings.product_name }}</strong>
                    {%- if block.settings.product_price != blank -%}
                      <span>{{ block.settings.product_price }}</span>
                    {%- endif -%}
                  </div>
                </div>
              {%- endif -%}
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</section>

<script>
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    const observerOptions = { threshold: 0.15, rootMargin: '0px 0px -80px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
        }
      });
    }, observerOptions);

    section.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));
  })();
</script>

{% schema %}
{
  "name": "ğŸ’¬ Testimonials",
  "tag": "section",
  "class": "section-emerson-testimonials",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow",
      "default": "Love Notes"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "header",
      "content": "Rating Badge"
    },
    {
      "type": "checkbox",
      "id": "show_rating_badge",
      "label": "Show rating badge",
      "default": true
    },
    {
      "type": "text",
      "id": "rating_text",
      "label": "Rating text",
      "default": "100% 5-Star Reviews"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#FDF9F6"
    },
    {
      "type": "range",
      "id": "scroll_speed",
      "label": "Scroll speed (seconds)",
      "min": 20,
      "max": 60,
      "step": 5,
      "default": 30
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "author",
          "label": "Author name",
          "default": "Sarah M."
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "Subtitle",
          "default": "Verified Buyer"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Avatar image",
          "info": "Optional. Initials used if blank."
        },
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "default": "The quality is absolutely amazing! My daughter loves that another kid made these. We've already ordered more for birthday gifts!"
        },
        {
          "type": "header",
          "content": "Product Reference"
        },
        {
          "type": "text",
          "id": "product_name",
          "label": "Product name",
          "default": "Rainbow Heart Tote"
        },
        {
          "type": "text",
          "id": "product_price",
          "label": "Product price",
          "default": "$28.00"
        },
        {
          "type": "text",
          "id": "product_emoji",
          "label": "Product emoji",
          "default": "ğŸŒˆ"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product image",
          "info": "Optional. Emoji used if blank."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "ğŸ’¬ Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "author": "Sarah M.",
            "quote": "The quality is absolutely amazing! My daughter loves that another kid made these. We've already ordered more for birthday gifts!",
            "product_name": "Rainbow Heart Tote",
            "product_price": "$28.00",
            "product_emoji": "ğŸŒˆ"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "author": "Mike R.",
            "quote": "Bought cards for everyone on my holiday list. They're so unique and heartfelt â€” nothing like them anywhere else. Will definitely be back!",
            "product_name": "Happy Sun Cards",
            "product_price": "$18.00",
            "product_emoji": "â˜€ï¸"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "author": "Lisa K.",
            "quote": "Beautiful artwork that brings so much joy! You can feel the happiness in every piece. It's hanging proudly in our living room now.",
            "product_name": "Purple Tree Print",
            "product_price": "$35.00",
            "product_emoji": "ğŸŒ³"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "author": "Jessica W.",
            "quote": "I'm obsessed with my new tote! It's colorful, well-made, and I get compliments every time I use it. Supporting young artists is the best!",
            "product_name": "Rainbow Heart Tote",
            "product_price": "$28.00",
            "product_emoji": "ğŸŒˆ"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "author": "David T.",
            "quote": "Perfect gift for my mom! She was so touched by the story behind the art. Fast shipping and beautiful packaging too.",
            "product_name": "Note Card Set",
            "product_price": "$18.00",
            "product_emoji": "ğŸ’Œ"
          }
        }
      ]
    }
  ]
}
{% endschema %}
