{% comment %}
  ════════════════════════════════════════════════════════════════
  EMERSON BY AVERY — FAQ SECTION
  Accordion with smooth animations and sticky sidebar
  ════════════════════════════════════════════════════════════════
{% endcomment %}

{{ 'section-emerson-faq.css' | asset_url | stylesheet_tag }}

<section 
  class="emerson-faq"
  data-section-id="{{ section.id }}"
  style="--section-bg: {{ section.settings.bg_color }};"
>
  <div class="emerson-faq__container">
    <!-- Content Side (Sticky) -->
    <div class="emerson-faq__content">
      {%- if section.settings.tag != blank -%}
        <span class="emerson-section-tag" data-animate="fade-up">{{ section.settings.tag }}</span>
      {%- endif -%}
      
      {%- if section.settings.heading != blank -%}
        <h2 class="emerson-section-title" data-animate="fade-up" data-delay="1">{{ section.settings.heading }}</h2>
      {%- endif -%}
      
      {%- if section.settings.subheading != blank -%}
        <p class="emerson-section-subtitle" data-animate="fade-up" data-delay="2">
          {{ section.settings.subheading }}
        </p>
      {%- endif -%}
      
      {%- if section.settings.button_text != blank and section.settings.button_link != blank -%}
        <a href="{{ section.settings.button_link }}" class="emerson-btn emerson-btn--secondary" data-animate="fade-up" data-delay="3" style="margin-top: 24px;">
          {{ section.settings.button_text }}
        </a>
      {%- endif -%}
    </div>

    <!-- FAQ List -->
    <div class="emerson-faq__list">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'faq' -%}
            <div 
              class="emerson-faq__item{% if forloop.first and section.settings.first_open %} active{% endif %}"
              data-animate="fade-up"
              data-delay="{{ forloop.index }}"
              {{ block.shopify_attributes }}
            >
              <button 
                class="emerson-faq__question"
                type="button"
                aria-expanded="{% if forloop.first and section.settings.first_open %}true{% else %}false{% endif %}"
                aria-controls="faq-answer-{{ block.id }}"
              >
                {{ block.settings.question }}
                <span class="emerson-faq__icon">+</span>
              </button>
              <div class="emerson-faq__answer" id="faq-answer-{{ block.id }}">
                <div class="emerson-faq__answer-inner">
                  {{ block.settings.answer }}
                </div>
              </div>
            </div>
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>
</section>

<script>
  (function() {
    const section = document.querySelector('[data-section-id="{{ section.id }}"]');
    if (!section) return;

    // Animation Observer
    const observerOptions = { threshold: 0.15, rootMargin: '0px 0px -80px 0px' };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
        }
      });
    }, observerOptions);

    section.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));

    // Accordion functionality
    const questions = section.querySelectorAll('.emerson-faq__question');
    
    questions.forEach(question => {
      question.addEventListener('click', () => {
        const item = question.parentElement;
        const isActive = item.classList.contains('active');
        const answer = item.querySelector('.emerson-faq__answer');
        
        // Close all items
        section.querySelectorAll('.emerson-faq__item').forEach(i => {
          i.classList.remove('active');
          i.querySelector('.emerson-faq__question').setAttribute('aria-expanded', 'false');
        });
        
        // Open clicked item (if it wasn't already active)
        if (!isActive) {
          item.classList.add('active');
          question.setAttribute('aria-expanded', 'true');
        }
      });
    });
  })();
</script>

{% schema %}
{
  "name": "❓ FAQ",
  "tag": "section",
  "class": "section-emerson-faq",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "tag",
      "label": "Tag",
      "default": "FAQs"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Common Questions"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Everything you need to know about shopping with us. Can't find what you're looking for? Reach out!"
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "Contact Us"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Settings"
    },
    {
      "type": "checkbox",
      "id": "first_open",
      "label": "First FAQ open by default",
      "default": true
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#FDF9F6"
    }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "Who is Avery?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>Avery is our 7-year-old artist extraordinaire! She's been drawing since she could hold a crayon, and her colorful creations have brought joy to homes across the world. Every design in our shop is her original artwork.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "❓ FAQ",
      "blocks": [
        {
          "type": "faq",
          "settings": {
            "question": "Who is Avery?",
            "answer": "<p>Avery is our 7-year-old artist extraordinaire! She's been drawing since she could hold a crayon, and her colorful creations have brought joy to homes across the world. Every design in our shop is her original artwork.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "<p>Standard shipping within the US takes 3-5 business days. International orders typically arrive within 7-14 business days. All orders ship free — because spreading joy shouldn't cost extra!</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We want you to love your purchase! If something isn't right, we accept returns within 30 days of delivery. Items must be unused and in original packaging. Contact us and we'll make it right.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Do you offer custom orders?",
            "answer": "<p>Yes! Avery loves creating custom pieces. Whether it's a personalized gift or a special request, reach out through our contact form and we'll work with you to create something magical.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "Are products eco-friendly?",
            "answer": "<p>We care about the planet! Our packaging is made from recycled materials, and we partner with print-on-demand suppliers who use sustainable practices. Art that's good for the soul and the Earth.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}